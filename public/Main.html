<!DOCTYPE html>
<html lang="kor">

<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">OntheFood222</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="#">로그아웃</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" onclick="AddResBtn()">맛집추가</a>
          </li>
        </ul>
        <form class="d-flex">
          <input class="form-control me-2" type="search" placeholder="맛집 찾기" aria-label="Search">
          <button class="btn btn-outline-success" type="submit" style="width: 100px;">검색</button>
        </form>
      </div>
    </div>
  </nav>
  <div>
    <div id="map" style="width:100%;height:700px;"></div>
  </div>
  <div>
    <button class="btn btn-outline-success" id="koreanBtn" style="width: 100px;">한식</button>
  </div>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous" ;>
  </script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script type="text/javascript"
    src="//dapi.kakao.com/v2/maps/sdk.js?appkey=ba661691f76964ef92150a4adc16d7eb&libraries=services"></script>

  <script src="map.js"></script>

  <script src="/__/firebase/8.6.5/firebase-app.js"></script>
  <script src="/__/firebase/8.6.5/firebase-auth.js"></script>
  <script src="/__/firebase/8.6.5/firebase-firestore.js"></script>
  <script src="/__/firebase/8.6.5/firebase-storage.js"></script>

  <script>
    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBrfN7fIlGUuBVTRx8qJyZrjUrdH7aOZ9I",
      authDomain: "otf-firebase-5120d.firebaseapp.com",
      projectId: "otf-firebase-5120d",
      storageBucket: "otf-firebase-5120d.appspot.com",
      messagingSenderId: "108770123410",
      appId: "1:108770123410:web:892719a7feb9042352904b"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
  </script>

  <script>
    const db = firebase.firestore();
    db.collection('Restaurant').get().then((snapshot) => {
      snapshot.forEach((doc) => {
        console.log(doc.data());
        var rAddress = doc.data().주소;
        var rName = doc.data().상호명;
        console.log(rAddress);
        console.log(rName);
        geocoder.addressSearch(rAddress, function (result, status) {

          // 정상적으로 검색이 완료됐으면 
          if (status === kakao.maps.services.Status.OK) {
            var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

            // 결과값으로 받은 위치를 마커로 표시합니다
            var marker = new kakao.maps.Marker({
              map: map,
              position: coords,
              clickable: true
            });

            var iwContent = `<div style="padding:5px;">상호명 : ${rName}<br>
              주소 : ${rAddress}
              </div>`,
              iwRemoveable = true; // removeable 속성을 ture 로 설정하면 인포윈도우를 닫을 수 있는 x버튼이 표시됩니다

            // 인포윈도우로 장소에 대한 설명을 표시합니다
            var infowindow = new kakao.maps.InfoWindow({
              content: iwContent,
              removable: iwRemoveable
            });
            kakao.maps.event.addListener(marker, 'click', function () {
              // 마커 위에 인포윈도우를 표시합니다
              infowindow.open(map, marker);
            });
          }
        });
      });
    });
  </script>
  <script>
    $('#koreanBtn').click(function () {
      const db = firebase.firestore();
      db.collection('Restaurant').get().then((snapshot) => {
        snapshot.forEach((doc) => {
          console.log(doc.data());
          var rAddress = doc.data().주소;
          var rName = doc.data().상호명;
          var rKinds = doc.data().종류;
          console.log(rAddress);
          console.log(rName);
          console.log(rKinds);
          if (rKinds === '한식') {
            geocoder.addressSearch(rAddress, function (result, status) {

              // 정상적으로 검색이 완료됐으면
              if (status === kakao.maps.services.Status.OK) {
                var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

                // 결과값으로 받은 위치를 마커로 표시합니다
                var marker = new kakao.maps.Marker({
                  map: map,
                  position: coords,
                  clickable: true
                });

                var iwContent = `<div style="padding:5px;">상호명 : ${rName}<br>주소 : ${rAddress}</div>`,iwRemoveable = true; // removeable 속성을 ture 로 설정하면 인포윈도우를 닫을 수 있는 x버튼이 표시됩니다

                // 인포윈도우로 장소에 대한 설명을 표시합니다
                var infowindow = new kakao.maps.InfoWindow({
                  content: iwContent,
                  removable: iwRemoveable
                });
                kakao.maps.event.addListener(marker, 'click', function () {
                  // 마커 위에 인포윈도우를 표시합니다
                  infowindow.open(map, marker);
                });
              }
            });
          }

        });
      });
    })
  </script>
</body>

</html>